<!DOCTYPE html>
<html lang="de" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Steuerformular - Stammdaten</title>

    <link href="/static/css/bootstrap.min.css" rel="stylesheet">
    <link href="/static/css/sign-in.css" rel="stylesheet">
</head>
        <body class="d-flex align-items-center py-4 bg-body-tertiary">
            <div class="container">
                <div class="text-end mb-3">
                    <button id="theme-toggle" class="btn btn-primary">
                        <span id="theme-icon">üåô</span> Dark Mode
                    </button>
                </div>
                <main class="form-signin w-100 m-auto">
                    <form method="POST" action="{{ url_for('forms.create_form') }}">
                        <h1 class="h3 mb-3 fw-normal">Steuerformular - Stammdaten</h1>

                        {% with messages = get_flashed_messages(with_categories=true) %}
                          {% if messages %}
                            <div class="mb-3">
                              <ul class="list-group">
                                {% for category, message in messages %}
                                  <li class="list-group-item list-group-item-{{ category }}">{{ message }}</li>
                                {% endfor %}
                              </ul>
                            </div>
                          {% endif %}
                        {% endwith %}

                        <div class="mb-3">
                            <label for="name" class="form-label">Name</label>
                            <input type="text" class="form-control" id="name" name="name" value="{{ form_data.get('name', '') }}" required>
                        </div>

                        <div class="mb-3">
                            <label for="surname" class="form-label">Nachname</label>
                            <input type="text" class="form-control" id="surname" name="surname" value="{{ form_data.get('surname', '') }}" required>
                        </div>

                        <div class="mb-3">
                            <label for="tax_id" class="form-label">Steuer-ID</label>
                            <input type="text" class="form-control" id="tax_id" name="tax_id" value="{{ form_data.get('tax_id', '') }}" pattern="^\d{11}$" inputmode="numeric" minlength="11" maxlength="11" placeholder="11-stellige Steuer-ID" title="Bitte 11 Ziffern ohne Leerzeichen eingeben." required>
                        </div>

                        <div class="mb-3">
                            <label for="tax_class" class="form-label">Steuerklasse</label>
                            <input type="text" class="form-control" id="tax_class" name="tax_class" value="{{ form_data.get('tax_class', '') }}" required>
                        </div>

                        <div class="mb-3">
                            <label for="family_status" class="form-label">Familienstand</label>
                            <select id="family_status" name="family_status" class="form-select" required>
                                <option value="single" {% if form_data.get('family_status') == 'single' %}selected{% endif %}>Ledig</option>
                                <option value="married" {% if form_data.get('family_status') == 'married' %}selected{% endif %}>Verheiratet</option>
                                <option value="divorced" {% if form_data.get('family_status') == 'divorced' %}selected{% endif %}>Geschieden</option>
                            </select>
                        </div>

                        <div class="mb-3">
                            <label class="form-label">Haben Sie Kinder?</label>
                            <div>
                                <div class="form-check form-check-inline">
                                    <input type="radio" class="form-check-input" id="children_yes" name="children" value="yes" onclick="toggleChildrenField()" {% if form_data.get('children', form_data.get('has_children')) == 'yes' %}checked{% endif %}>
                                    <label class="form-check-label" for="children_yes">Ja</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input type="radio" class="form-check-input" id="children_no" name="children" value="no" onclick="toggleChildrenField()" {% if form_data.get('children', form_data.get('has_children', 'no')) == 'no' %}checked{% endif %}>
                                    <label class="form-check-label" for="children_no">Nein</label>
                                </div>
                            </div>

                            <div id="children_count" class="mt-3" style="display: none;">
                                <label for="num_children" class="form-label">Anzahl der Kinder</label>
                                <input type="number" class="form-control" id="num_children" name="num_children" min="0" value="{{ form_data.get('num_children', '') }}" onchange="toggleChildDetails()">
                            </div>
                        </div>

                        <div id="child_details_container" class="mb-3"></div>

                        <div class="mb-3">
                            <label for="remarks" class="form-label">Bemerkungen</label>
                            <textarea id="remarks" name="remarks" rows="4" class="form-control">{{ form_data.get('remarks', '') }}</textarea>
                        </div>

                        <button class="btn btn-primary w-100 py-2" type="submit">Weiter</button>

                        <p class="mt-3 text-center"><a href="{{ url_for('main.dashboard') }}">Zur√ºck zum Dashboard</a></p>
                    </form>
                </main>
            </div>

            <script src="/static/js/bootstrap.bundle.min.js"></script>

            <script>
                // Theme toggle (shared)
                function toggleTheme() {
                    const htmlElement = document.documentElement;
                    const currentTheme = htmlElement.getAttribute('data-bs-theme');
                    const newTheme = currentTheme === 'dark' ? 'light' : 'dark';
                    htmlElement.setAttribute('data-bs-theme', newTheme);
                    const themeIcon = document.getElementById('theme-icon');
                    const themeToggle = document.getElementById('theme-toggle');
                    if (newTheme === 'dark') {
                        themeIcon.textContent = 'üåô';
                        themeToggle.innerHTML = '<span id="theme-icon">üåô</span> Dark Mode';
                    } else {
                        themeIcon.textContent = '‚òÄÔ∏è';
                        themeToggle.innerHTML = '<span id="theme-icon">‚òÄÔ∏è</span> Light Mode';
                    }
                    localStorage.setItem('theme', newTheme);
                }

                document.addEventListener('DOMContentLoaded', () => {
                    const savedTheme = localStorage.getItem('theme') || 'dark';
                    document.documentElement.setAttribute('data-bs-theme', savedTheme);
                    const themeIcon = document.getElementById('theme-icon');
                    const themeToggle = document.getElementById('theme-toggle');
                    if (savedTheme === 'dark') {
                        themeIcon.textContent = 'üåô';
                        themeToggle.innerHTML = '<span id="theme-icon">üåô</span> Dark Mode';
                    } else {
                        themeIcon.textContent = '‚òÄÔ∏è';
                        themeToggle.innerHTML = '<span id="theme-icon">‚òÄÔ∏è</span> Light Mode';
                    }
                    document.getElementById('theme-toggle').addEventListener('click', toggleTheme);
                });

                // JS von vorher, beibehalten
                function toggleChildrenField() {
                    var hasChildren = document.getElementById('children_yes').checked;
                    var childrenCountField = document.getElementById('children_count');
                    if (hasChildren) {
                        childrenCountField.style.display = 'block';
                    } else {
                        childrenCountField.style.display = 'none';
                        // auch Child-Details leeren
                        var childDetailsContainer = document.getElementById('child_details_container');
                        childDetailsContainer.innerHTML = '';
                    }
                }

                function toggleChildDetails() {
                    var numChildren = document.getElementById('num_children').value;
                    var childDetailsContainer = document.getElementById('child_details_container');
                    childDetailsContainer.innerHTML = ''; // Clear previous child details

                    if (numChildren > 0) {
                        for (var i = 1; i <= numChildren; i++) {
                            var childDetails = document.createElement('div');
                            childDetails.className = 'border rounded p-3 mb-2';
                            childDetails.innerHTML = `
                                <h5>Kind ${i}</h5>
                                <div class="mb-2">
                                  <label class="form-label" for="child${i}_name">Vorname</label>
                                  <input type="text" class="form-control" id="child${i}_name" name="child${i}_name" required>
                                </div>
                                <div class="mb-2">
                                  <label class="form-label" for="child${i}_birthdate">Geburtsdatum</label>
                                  <input type="date" class="form-control" id="child${i}_birthdate" name="child${i}_birthdate" required>
                                </div>
                                <div class="mb-2">
                                  <label class="form-label">Kindergeld erhalten?</label><br>
                                  <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="child${i}_allowance_yes" name="child${i}_allowance" value="yes"> <label class="form-check-label" for="child${i}_allowance_yes">Ja</label>
                                  </div>
                                  <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="radio" id="child${i}_allowance_no" name="child${i}_allowance" value="no"> <label class="form-check-label" for="child${i}_allowance_no">Nein</label>
                                  </div>
                                </div>
                            `;
                            childDetailsContainer.appendChild(childDetails);
                        }
                    }
                }

                // initiale Anzeige, falls Daten vorhanden
                document.addEventListener('DOMContentLoaded', function() {
                    if (document.getElementById('children_yes').checked) {
                        document.getElementById('children_count').style.display = 'block';
                    }
                });
            </script>
        </body>
        </html>
            </select>
